{% extends "base.html" %}
{% load humanize %}
{% block content %}

<style>
.container, .container-fluid, .content-wrapper {
  padding-left: 3px !important;
  padding-right: 3px !important;
  margin-left: 3px !important;
  margin-right: 3px !important;
}
</style>

<div class="container mt-5">
  <!-- Header + Filter -->
  <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4 gap-2">
    <h2 class="mb-2 mb-md-0">All Bills</h2>
    {% if user.role == 'landlord' %}
      <form method="get" class="d-flex flex-wrap gap-2 w-100 w-md-auto">
        <input type="text" name="tenant" placeholder="Filter by tenant" class="form-control me-2" value="{{ tenants_filter }}">
        <button class="btn btn-primary">Filter</button>
      </form>
    {% endif %}
  </div>

  {% if bills %}
    <div class="table-responsive">
      <table class="table table-bordered table-striped table-sm mb-0">
        <thead class="table-light">
          <tr>
            <th>Tenant</th>
            <th>Period</th>
            <th>Rent</th>
            <th>Meter Bill</th>
            <th>Misc</th>
            <th>Total</th>
            <th>Paid</th>
            <th>Remaining</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for bill in bills %}
          <tr>
            <td>
              {% if bill.offline_tenant %}{{ bill.offline_tenant.name }}
              {% elif bill.online_tenant %}{{ bill.online_tenant.tenant.get_full_name|default:bill.online_tenant.tenant.username }}
              {% endif %}
            </td>
            <td>{{ bill.start_date }} → {{ bill.end_date }}</td>
            <td>₹{{ bill.rent|intcomma }}</td>
            <td>₹{{ bill.meter_bill|intcomma }}</td>
            <td>₹{{ bill.misc_charge|intcomma }}</td>
            <td>₹{{ bill.total_bill_amount|intcomma }}</td>
            <td>₹{{ bill.amount_paid|intcomma }}</td>
            <td>₹{{ bill.remaining_due|intcomma }}</td>
            <td>{{ bill.get_status_display }}</td>
            <td>
              <a href="{% url 'bill_detail' bill.id %}?next={{ request.get_full_path }}" class="btn btn-sm btn-info">View</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p class="text-muted">No bills available.</p>
  {% endif %}
</div>

{% endblock %}
